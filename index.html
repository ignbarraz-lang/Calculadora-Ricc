<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINSTELEC CHILE - Sistema de Ingenier√≠a</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --primary: #3498db; --dark: #2c3e50; --success: #27ae60; 
            --danger: #e74c3c; --bg: #f8fafc; --white: #ffffff; --luis: #8e44ad;
        }
        
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; color: var(--dark); }
        
        /* LOGIN */
        #login-wrapper { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--dark) 0%, #1a252f 100%); }
        .login-card { background: var(--white); padding: 40px; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3); text-align: center; width: 100%; max-width: 350px; }
        .login-logo { width: 120px; height: auto; margin-bottom: 25px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .login-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        
        /* NAVBAR (Solo Logo) */
        .navbar { background: var(--dark); color: white; padding: 0.8rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .nav-logo { height: 45px; width: auto; background: white; padding: 4px; border-radius: 6px; }

        /* CONTAINER & TABS */
        .main-container { max-width: 950px; margin: 20px auto; padding: 0 20px; display: none; }
        .calc-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { padding: 12px 20px; border: none; border-radius: 12px; background: var(--white); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.05); white-space: nowrap; font-size: 0.9rem; }
        .tab-btn.active { background: var(--primary); color: white; }
        
        /* CARDS */
        .card { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        .card.active { display: block; border-top: 4px solid var(--primary); }
        .card h2 { margin-top: 0; font-size: 1.2rem; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        /* GRID DE NODOS */
        .nodo-box { background: #f8fafc; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 15px; }
        .nodo-header { font-weight: bold; color: var(--dark); margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .nodo-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .form-group { margin-bottom: 10px; }
        label { display: block; margin-bottom: 4px; font-weight: 600; font-size: 0.8rem; color: #64748b; }
        select, input { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem; box-sizing: border-box; }
        
        .btn-calc { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-calc:hover { background: #2980b9; }

        /* RESULTADOS */
        .res-nodos { margin-top: 20px; padding: 15px; border-radius: 10px; background: #eef2ff; border-left: 5px solid #4f46e5; }
        .res-line { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e7ff; font-size: 0.9rem; }
        .res-line:last-child { border: none; font-weight: bold; color: #1e1b4b; }

        iframe { width: 100%; height: 75vh; border-radius: 10px; border: 1px solid #e2e8f0; margin-top: 15px; }
    </style>
</head>
<body>

<div id="login-wrapper">
    <div class="login-card">
        <img src="logo.png" alt="Logo LINSTELEC" class="login-logo">
        <input type="text" id="userInput" placeholder="Usuario">
        <input type="password" id="passInput" placeholder="Contrase√±a">
        <button class="btn-calc" onclick="checkLogin()">INGRESAR</button>
        <p id="error-msg" style="color:var(--danger); display:none; font-size:14px; margin-top:10px;">Acceso denegado</p>
    </div>
</div>

<div id="main-app" style="display:none;">
    <nav class="navbar">
        <div class="nav-brand">
            <img src="logo.png" alt="Logo LINSTELEC" class="nav-logo">
        </div>
        <div id="user-display" style="font-size: 14px; opacity: 0.9; font-weight: bold;"></div>
        <a href="#" onclick="location.reload()" style="color:white; text-decoration:none;"><i class="fas fa-power-off"></i></a>
    </nav>

    <div class="main-container" id="container" style="display:block;">
        <div class="calc-tabs">
            <button class="tab-btn active" onclick="showTab(event, 'nodos-tab')"><i class="fas fa-network-wired"></i> C√ÅLCULO DE NODOS</button>
            <button class="tab-btn" onclick="showTab(event, 'tension')"><i class="fas fa-wave-square"></i> CA√çDA TENSI√ìN</button>
            <button class="tab-btn" onclick="showTab(event, 'sgc')"><i class="fas fa-project-diagram"></i> ESQUEMA SGC</button>
            <button class="tab-btn" onclick="showTab(event, 'biblioteca')"><i class="fas fa-book"></i> BIBLIOTECA RIC</button>
            <button class="tab-btn" style="background:var(--luis); color:white;" onclick="showTab(event, 'luis-ia')"><i class="fas fa-robot"></i> PREG√öNTALE A LUIS</button>
        </div>

        <div id="nodos-tab" class="card active">
            <h2><i class="fas fa-microchip"></i> Impedancia y Cortocircuito Acumulativo</h2>
            <div class="nodo-box" style="background: #fff4e6; border-color: #ffd8a8;">
                <div class="nodo-header">DATOS DE LA FUENTE (RED)</div>
                <div class="form-group">
                    <label>Icc Inicial en Empalme (kA):</label>
                    <input type="number" id="icc-fuente" value="6" step="0.1">
                </div>
            </div>

            <div class="nodo-box">
                <div class="nodo-header">1. TRAMO: FUENTE ‚Üí EMPALME</div>
                <div class="nodo-inputs">
                    <div class="form-group"><label>Longitud (m):</label><input type="number" id="L1" value="5"></div>
                    <div class="form-group">
                        <label>Secci√≥n (mm¬≤):</label>
                        <select id="S1"><option value="6">6 mm¬≤</option><option value="10">10 mm¬≤</option><option value="16">16 mm¬≤</option></select>
                    </div>
                </div>
            </div>

            <div class="nodo-box">
                <div class="nodo-header">2. TRAMO: EMPALME ‚Üí TDF VOLTEX</div>
                <div class="nodo-inputs">
                    <div class="form-group"><label>Longitud (m):</label><input type="number" id="L2" value="10"></div>
                    <div class="form-group">
                        <label>Secci√≥n (mm¬≤):</label>
                        <select id="S2"><option value="6" selected>6 mm¬≤</option><option value="10">10 mm¬≤</option><option value="4">4 mm¬≤</option></select>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="nodo-box">
                    <div class="nodo-header">3. TDF ‚Üí SAVE.01</div>
                    <label>Longitud (m):</label><input type="number" id="L3" value="12">
                    <label>Secci√≥n (mm¬≤):</label><select id="S3"><option value="6">6 mm¬≤</option><option value="4">4 mm¬≤</option></select>
                </div>
                <div class="nodo-box">
                    <div class="nodo-header">4. TDF ‚Üí TDA HOGAR</div>
                    <label>Longitud (m):</label><input type="number" id="L4" value="8">
                    <label>Secci√≥n (mm¬≤):</label><select id="S4"><option value="2.5">2.5 mm¬≤</option><option value="4">4 mm¬≤</option></select>
                </div>
            </div>

            <button class="btn-calc" onclick="calcularNodos()">CALCULAR NODOS LINSTELEC</button>

            <div id="resultado-nodos" class="res-nodos" style="display:none;">
                <h4 style="margin:0 0 10px 0;">INFORME DE IMPEDANCIA (Z) Y FALLA (kA)</h4>
                <div id="nodos-list"></div>
            </div>
        </div>

        <div id="tension" class="card">
            <h2>Calculadora RIC 04</h2>
            <div class="form-group"><label>Distancia (m):</label><input type="number" id="dist" value="10"></div>
            <div class="form-group"><label>Corriente (A):</label><input type="number" id="amp" value="16"></div>
            <button class="btn-calc" onclick="calcTension()">CALCULAR P√âRDIDA</button>
            <div id="res-tension"></div>
        </div>

        <div id="sgc" class="card" style="text-align:center;">
            <h2>Esquema de Control SGC</h2>
            <svg viewBox="0 0 400 280" xmlns="http://www.w3.org/2000/svg" style="background:#fff; border-radius:10px; border:1px solid #ddd;">
                <text x="95" y="30" font-weight="bold" fill="#2c3e50">SGC (Control)</text>
                <text x="280" y="30" font-weight="bold" fill="#2c3e50">CARGADOR</text>
                <circle cx="35" cy="100" r="7" fill="#2ecc71"/><circle cx="75" cy="100" r="7" fill="#3498db"/>
                <circle cx="290" cy="100" r="7" fill="#8b4513"/><circle cx="330" cy="100" r="7" fill="#2ecc71"/>
                <path d="M 35 100 L 35 130 L 330 130 L 330 107" stroke="#2ecc71" fill="none" stroke-width="2.5"/>
                <path d="M 75 107 L 75 235 L 290 235 L 290 107" stroke="#3498db" fill="none" stroke-width="2.5"/>
            </svg>
        </div>

        <div id="biblioteca" class="card">
            <h2>Normativa RIC Vigente</h2>
            <select onchange="document.getElementById('pdf-view').src = this.value" style="margin-bottom:15px;">
                <option value="">-- Seleccionar Pliego --</option>
                <option value="RIC01.pdf">RIC 01: Empalmes</option><option value="RIC02.pdf">RIC 02: Tableros</option>
                <option value="RIC15.pdf">RIC 15: Carga VE</option><option value="RIC15.1.pdf">RIC 15.1: Interoperabilidad</option>
                <option value="RIC19.pdf">RIC 19: Puesta en Servicio</option>
            </select>
            <iframe id="pdf-view" src=""></iframe>
        </div>

        <div id="luis-ia" class="card">
            <h2>ü§ñ PREG√öNTALE A LUIS</h2>
            <iframe src="https://brayaton-asistente-ric-pro.hf.space"></iframe>
        </div>
    </div>
</div>

<script>
    const USERS = [{id:"Padilla",pass:"1648",name:"Padilla"},{id:"Isaias",pass:"2071",name:"Isaias"},{id:"Brayan",pass:"2025",name:"B. Barraza"}];

    function checkLogin() {
        const u = document.getElementById('userInput').value, p = document.getElementById('passInput').value;
        const found = USERS.find(user => user.id === u && user.pass === p);
        if(found) {
            document.getElementById('login-wrapper').style.display='none';
            document.getElementById('main-app').style.display='block';
            document.getElementById('user-display').innerText = "üë∑ " + found.name;
            iniciarChatbase();
        } else { document.getElementById('error-msg').style.display='block'; }
    }

    function showTab(evt, name) {
        let cards = document.getElementsByClassName("card"), btns = document.getElementsByClassName("tab-btn");
        for (let i=0; i<cards.length; i++) cards[i].classList.remove("active");
        for (let i=0; i<btns.length; i++) btns[i].classList.remove("active");
        document.getElementById(name).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // --- L√ìGICA DE NODOS ACUMULATIVA ---
    function calcularNodos() {
        const V = 220, rho = 0.0185;
        const icc_f = parseFloat(document.getElementById('icc-fuente').value);
        let Z_red = V / (icc_f * 1000); // Impedancia inicial en Ohms

        function getZcable(L, S) { return (rho * L * 2) / S; }

        // 1. Fuente a Empalme
        let z1 = Z_red + getZcable(parseFloat(document.getElementById('L1').value), parseFloat(document.getElementById('S1').value));
        // 2. Fuente a TDF
        let z2 = z1 + getZcable(parseFloat(document.getElementById('L2').value), parseFloat(document.getElementById('S2').value));
        // 3. Fuente a SAVE
        let z3 = z2 + getZcable(parseFloat(document.getElementById('L3').value), parseFloat(document.getElementById('S3').value));
        // 4. Fuente a TDA
        let z4 = z2 + getZcable(parseFloat(document.getElementById('L4').value), parseFloat(document.getElementById('S4').value));

        const resDiv = document.getElementById('nodos-list');
        resDiv.innerHTML = `
            <div class="res-line"><span>Z Fuente-Empalme:</span><span>${z1.toFixed(4)} Œ© (${(V/(z1*1000)).toFixed(2)} kA)</span></div>
            <div class="res-line"><span>Z Fuente-TDF Voltex:</span><span>${z2.toFixed(4)} Œ© (${(V/(z2*1000)).toFixed(2)} kA)</span></div>
            <div class="res-line"><span>Z Fuente-SAVE.01:</span><span>${z3.toFixed(4)} Œ© (${(V/(z3*1000)).toFixed(2)} kA)</span></div>
            <div class="res-line"><span>Z Fuente-TDA Hogar:</span><span>${z4.toFixed(4)} Œ© (${(V/(z4*1000)).toFixed(2)} kA)</span></div>
        `;
        document.getElementById('resultado-nodos').style.display = 'block';
    }

    function calcTension() {
        let dv = (2 * parseFloat(document.getElementById('dist').value) * parseFloat(document.getElementById('amp').value) * 0.018) / 6;
        let p = (dv / 220) * 100;
        document.getElementById('res-tension').innerHTML = `<div class="resultado ${p<=3?'res-ok':'res-fail'}">P√©rdida: ${p.toFixed(2)}%</div>`;
    }

    function iniciarChatbase() {
        const s = document.createElement("script");
        s.src = "https://www.chatbase.co/embed.min.js";
        s.id = "HZBhzPxQtpDaw6ZlcBzEA";
        document.body.appendChild(s);
    }
</script>
</body>
</html>
